<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
     <title>WS Security API</title>
  <link href="style/api_style.css" rel="stylesheet" type="text/css" media="all" />
</head>
<body>
<h1>WS Security API</h1>
    <h2>Predefined Classes For WS Security</h2>
    
    <h3 id="wspolicy">WSPolicy</h3>
    <h4 id="ws_policy_construct">Constructor</h4>
    <p>
        <strong>WSPolicy(mixed policy)</strong></p>
    <p>
        Construct a new WSPolicy Object.
        Policy can be one of following.</p>
    <p>
        &nbsp; 1. xml string representing the corresponding policy.</p>
    <p>
        &nbsp; 2 dom node representing the corresponding policy.</p>
    <p>
        &nbsp; 3 array <br />
         &nbsp;&nbsp; &nbsp;&nbsp;Array of options can be specified using below syntax.<br />
           &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;i)  array("security"=>array of security options)<br />
             &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ii)  array("security"=>array( "inpolicy"=> array of security options | xml string | dom node,<br />
             &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
        &nbsp;"outpolicy"=> array of security options | xml string | dom node));
    </p>    
    <p> Here, inpolicy and outpolicy is refered to as the policy to be used for the incoming message and outgoing messages. </p>     
    <p>
        When using WSPolicy, user can use a policy xml file to configue the security options
        to be used. When the user has a policy file he can create a policy object using
        an xml string or dom node corresponding to that policy file. This is the encouraged
        senario. In addition to that, wsf4php security api provide the user to configure
        some minimum set of security features by using an options array that is accepted
        by WSPolicy constructor. Following is a description of the avalible options in the
        options array. Examples will be provided on policy files later in this document.</p>
    <p>
        &nbsp;</p>
    <p>
        <table border="1">
            <tr>
                <th id="policy_options">
                    Option
                </th>
                <th>
                    Data Type
                </th>
                <th style="width: 195px">
                    Value Domain
                </th>
                <th>
                    Default Value
                </th>
                <th>
                    Description
                </th>
            </tr>
            <tr>
                <td>
                    sign
                </td>
                <td>
                    string | boolean
                </td>
                <td style="width: 195px">
                    TRUE | "X509"
                </td>
                <td>
                    FALSE
                </td>
                <td >
                    Whether to sign the xml message or not.By default signing is not enabled.
                    <br clear="all" />
                    If specified "sign"=&gt;TRUE, the body part of the soap message will be signed using
                    X509 Standard. The other avilable option is "Keberose".
                    <br clear="all" />
                    Signing will be done on the body part of the message. To sign the other parts of
                    the message, a &nbsp;policy file should be used.
                </td>
            </tr>
            <tr>
                <td>
                    encrypt
                </td>
                <td>
                    string | boolean
                </td>
                <td style="width: 195px">
                    TRUE | "X509"
                    <br clear="all" />
                </td>
                <td>
                    FALSE
                </td>
                <td>
                    Whether to encrypt the xml message or not. By default encryption is not enabled.
                    <br clear="all" />
                    If specified "encrypt"=&gt;TRUE, the body part of the soap message will be encrypted
                    using X509 Standard. The other avilable option is "Keberose".
                    <br clear="all" />
                    Encrypting will be done on the body part of the message. To encrypt headers , policy
                    file should be used.
                </td>
            </tr>
            <tr>
                <td>
                    algorithmSuite
                </td>
                <td>
                    string
                </td>
                <td style="width: 195px">
                    corresponds to Security Policy spec&nbsp; 7.1 [Algorithm Suite] definitions
                    <br clear="all" />
                </td>
                <td>
                    "Basic256Rsa15"
                </td>
                <td>
                    The symetric algorithm and asymetric algorithm will be &nbsp; derived from the algorithm
                    using string. If AlgorithmSuit is not specified the default value "Basic256Rsa15"
                    will be assumed.
                </td>
            </tr>
            <tr>
                <td>
                    layout
                </td>
                <td>
                    string
                </td>
                <td style="width: 195px">
                    "Strict" | "Lax"
                </td>
                <td>
                    "Strict"
                </td>
                <td>
                    These are defined in WS Security Policy Specification 1.1 section 7.7
                </td>
            </tr>
            <tr>
                <td>
                    includeTimestamp
                </td>
                <td>
                    bool
                </td>
                <td style="width: 195px">
                    TRUE
                </td>
                <td>
                    FALSE
                </td>
                <td>
                    If specified TRUE and user provided the ttl (time to live ) value when providing
                    security token object , timestamp will be used.
                </td>
            </tr>
            <tr>
                <td>
                    protectionOrder
                </td>
                <td>
                    string
                </td>
                <td style="width: 195px">
                    "EncryptBeforeSigning" | "SignBeforeEncrypt"
                </td>
                <td>
                    "EncryptBeforeSigning"
                </td>
                <td >
                    Order in which intergrity and confidentiality are applied to the message in cases
                    where both intergrity and confidentiality are required.
                </td>
            </tr>
            <tr>
                <td>
                    useUsernameToken
                </td>
                <td>
                    boolean
                </td>
                <td style="width: 195px">
                    TRUE
                </td>
                <td>
                    FALSE
                </td>
                <td>
                    If the necessary options are provided with the WSSecurityToken object and "useUsernameToken"=&gt;TRUE
                    , then UsernameToken will be enabled.
                </td>
            </tr>
            <tr>
                <td>
                    securityTokenReference
                </td>
                <td>
                    string
                </td>
                <td style="width: 195px">
                    "IssuerSerial" | "KeyIdentifier"|"EmbeddedToken"
                    <br clear="all" />
                    |"Thumbprint"| "Direct"
                    <br clear="all" />
                </td>
                <td>
                    "Direct"
                    <br clear="all" />
                </td>
                <td>
                    This option is common for both signing and encription.
                    <br clear="all" />
                    If the user wishes to have other options he should provide the appropriate policy
                    file. Direct Reference is treated as the default value.
                    <br clear="all" />
                </td>
            </tr>
        </table>
    </p>
    
    <h3 id="ws_security_token">WSSecurityToken</h3>
    <p>
        A PHP level object that logically represents security properties. This object will
        be used to specify the security properties from client</p>
    <p>
        or service.</p>
    <p>
        <b id="ws_security_token">WSSecurityToken::__construct(array of options)</b></p>
    <p>
        Options accepted in the message is specified below.</p>
    <table class="confluenceTable" border="1">
        <tr>
            <th class="confluenceTh">
                Option
            </th>
            <th class="confluenceTh">
                Data Type
            </th>
            <th class="confluenceTh">
                Value Domain
            </th>
            <th class="confluenceTh">
                Default Value
            </th>
            <th class="confluenceTh" style="width: 415px">
                Description
            </th>
        </tr>
        <tr>
            <td class="confluenceTd">
                user
            </td>
            <td class="confluenceTd">
                string
            </td>
            <td class="confluenceTd">
                string
            </td>
            <td class="confluenceTd">
                none
            </td>
            <td class="confluenceTd" style="width: 415px">
                Username
            </td>
        </tr>
        <tr>
            <td class="confluenceTd" style="height: 21px">
                certificate</td>
            <td class="confluenceTd" style="height: 21px">
                string
            </td>
            <td class="confluenceTd" style="height: 21px">
                string
            </td>
            <td class="confluenceTd" style="height: 21px">
                none
            </td>
            <td class="confluenceTd" style="width: 415px; height: 21px">
                User's certificate for sign loaded from thr function get_cert_from_file()</td>
        </tr>
        <tr>
            <td class="confluenceTd">
                passwordType
            </td>
            <td class="confluenceTd">
                string
            </td>
            <td class="confluenceTd">
                "PlainText" |"Digest"
            </td>
            <td class="confluenceTd">
                Digest
            </td>
            <td class="confluenceTd" style="width: 415px">
                Password type used in username token
            </td>
        </tr>
        <tr>
            <td class="confluenceTd">
                password
            </td>
            <td class="confluenceTd">
                string
            </td>
            <td class="confluenceTd">
                users password used for username token
            </td>
            <td class="confluenceTd">
                none
            </td>
            <td class="confluenceTd" style="width: 415px">
                User's certificate for sign loaded from the function get_cert_from_file()
            </td>
        </tr>
        <tr>
            <td class="confluenceTd" style="height: 21px">
                privateKey
            </td>
            <td class="confluenceTd" style="height: 21px">
                string
            </td>
            <td class="confluenceTd" style="height: 21px">
                user's private key as a string
            </td>
            <td class="confluenceTd" style="height: 21px">
                none
            </td>
            <td class="confluenceTd" style="width: 415px; height: 21px">
                User private key loaded from the function get_key_from_file()</td>
        </tr>
        <tr>
            <td class="confluenceTd">
                receiverCertificate</td>
            <td class="confluenceTd">
                string
            </td>
            <td class="confluenceTd">
                string&nbsp;<br clear="all" />
            </td>
            <td class="confluenceTd">
                none</td>
            <td class="confluenceTd" style="width: 415px">
                Receiver's certificate for encrypt from the function get_cert_from_file()</td>
        </tr>
        <tr>
            <td class="confluenceTd" style="height: 21px">
                receiverCertificateFormat</td>
            <td class="confluenceTd" style="height: 21px">
                string</td>
            <td class="confluenceTd" style="height: 21px">
                certificate format extension PEM</td>
            <td class="confluenceTd" style="height: 21px">
                PEM</td>
            <td class="confluenceTd" style="width: 415px; height: 21px">
                Receiver's certificate format</td>
        </tr>
        <tr>
            <td class="confluenceTd" style="height: 20px">
                certificateFormat</td>
            <td class="confluenceTd" style="height: 20px">
                string</td>
            <td class="confluenceTd" style="height: 20px">
                certificate format extension PEM</td>
            <td class="confluenceTd" style="height: 20px">
                PEM</td>
            <td class="confluenceTd" style="width: 415px; height: 20px">
                user's certificate format</td>
        </tr>
        <tr>
            <td class="confluenceTd">
                privateKeyFormat
            </td>
            <td class="confluenceTd">
                string
            </td>
            <td class="confluenceTd">
                key format extension PEM
                <br clear="all" />
            </td>
            <td class="confluenceTd">
                PEM
                <br clear="all" />
            </td>
            <td class="confluenceTd" style="width: 415px">
                Private key format
                <br clear="all" />
            </td>
        </tr>
        <tr>
            <td class="confluenceTd">
                ttl
                <br clear="all" />
            </td>
            <td class="confluenceTd">
                int
                <br clear="all" />
            </td>
            <td class="confluenceTd">
                <br clear="all" />
            </td>
            <td class="confluenceTd">
                &nbsp;</td>
            <td class="confluenceTd" style="width: 415px">
                Time in milliseconds
                <br clear="all" />
            </td>
        </tr>
    </table>
    <br />
    <p>
        Addtions to the WSClient</p>
    <p>
        "policy"=&gt;WSPolicy instance | array containing the incomming policy and outgoing
        policy as follows. "inpolicy"=&gt;$policy , "outpolicy"=&gt;$policy</p>
    <p>
        "securityToken" =&gt; WSSecurityToken instance</p>
    <p>
        &nbsp;Only a minimal set of securiy is processed as user options. For more complex
        senarios, user should provide the approriate policy file.</p>
    <p>
        Example WS Security Policy File.</p>
    <p>
        1] sample policy file.</p>
    <p>
        <font color="#0000ff">&lt;</font><font color="#990000">wsp:Policy</font> <font color="#ff0000">
            xmlns:wsp</font><font color="#0000ff">="</font><font color="#ff0000"><b><span class="nobr"><a
                href="http://schemas.xmlsoap.org/ws/2004/09/policy" rel="nofollow" title="Visit page outside Confluence"><span
                    style="font-size: 8pt"><span style="color: #003366">http://schemas.xmlsoap.org/ws/2004/09/policy<sup><img
                        align="absMiddle" alt="" border="0" class="rendericon" height="7" src="http://wso2.org/wiki/images/icons/linkext7.gif"
                        width="7" /></sup></span></span></a></span></b></font><font color="#0000ff">"</font><font
                            color="#0000ff">&gt;</font>- <font color="#0000ff">&lt;</font><font color="#990000">wsp:ExactlyOne</font><font
                                color="#0000ff">&gt;</font>- <font color="#0000ff">&lt;</font><font color="#990000">wsp:All</font><font
                                    color="#0000ff">&gt;</font>- <font color="#0000ff">&lt;</font><font color="#990000">sp:AsymmetricBinding</font>
        <font color="#ff0000">xmlns:sp</font><font color="#0000ff">="</font><font color="#ff0000"><b><span
            class="nobr"><a href="http://schemas.xmlsoap.org/ws/2005/07/securitypolicy" rel="nofollow"
                title="Visit page outside Confluence"><span style="font-size: 8pt"><span style="color: #003366">http://schemas.xmlsoap.org/ws/2005/07/securitypolicy<sup><img
                    align="absMiddle" alt="" border="0" class="rendericon" height="7" src="http://wso2.org/wiki/images/icons/linkext7.gif"
                    width="7" /></sup></span></span></a></span></b></font><font color="#0000ff">"</font><font
                        color="#0000ff">&gt;</font>- <font color="#0000ff">&lt;</font><font color="#990000">wsp:Policy</font><font
                            color="#0000ff">&gt;</font>- <font color="#0000ff">&lt;</font><font color="#990000">sp:InitiatorToken</font><font
                                color="#0000ff">&gt;</font>- <font color="#0000ff">&lt;</font><font color="#990000">wsp:Policy</font><font
                                    color="#0000ff">&gt;</font>- <font color="#0000ff">&lt;</font><font color="#990000">sp:X509Token</font>
        <font color="#990000">sp:IncludeToken</font><font color="#0000ff">="</font>*<span
            class="nobr"><a href="http://schemas.xmlsoap.org/ws/2005/07/securitypolicy/IncludeToken/Always"
                rel="nofollow" title="Visit page outside Confluence"><span style="font-size: 8pt"><span
                    style="color: #003366">http://schemas.xmlsoap.org/ws/2005/07/securitypolicy/IncludeToken/Always<sup><img
                        align="absMiddle" alt="" border="0" class="rendericon" height="7" src="http://wso2.org/wiki/images/icons/linkext7.gif"
                        width="7" /></sup></span></span></a></span>*<font color="#0000ff">"</font><font color="#0000ff">&gt;</font>-
        <font color="#0000ff">&lt;</font><font color="#990000">wsp:Policy</font><font color="#0000ff">&gt;</font><br />
        <font color="#ff0000"><b>&nbsp;</b></font> <font color="#0000ff">&lt;</font><font
            color="#990000">sp:WssX509V3Token10</font> <font color="#0000ff">/&gt;</font><br />
        <font color="#ff0000"><b>&nbsp;</b></font> <font color="#0000ff">&lt;/</font><font
            color="#990000">wsp:Policy</font><font color="#0000ff">&gt;</font><br />
        <font color="#ff0000"><b>&nbsp;</b></font> <font color="#0000ff">&lt;/</font><font
            color="#990000">sp:X509Token</font><font color="#0000ff">&gt;</font><br />
        <font color="#ff0000"><b>&nbsp;</b></font> <font color="#0000ff">&lt;/</font><font
            color="#990000">wsp:Policy</font><font color="#0000ff">&gt;</font><br />
        <font color="#ff0000"><b>&nbsp;</b></font> <font color="#0000ff">&lt;/</font><font
            color="#990000">sp:InitiatorToken</font><font color="#0000ff">&gt;</font>- <font
                color="#0000ff">&lt;</font><font color="#990000">sp:RecipientToken</font><font color="#0000ff">&gt;</font>-
        <font color="#0000ff">&lt;</font><font color="#990000">wsp:Policy</font><font color="#0000ff">&gt;</font>-
        <font color="#0000ff">&lt;</font><font color="#990000">sp:X509Token</font> <font
            color="#990000">sp:IncludeToken</font><font color="#0000ff">="</font>*<span class="nobr"><a
                href="http://schemas.xmlsoap.org/ws/2005/07/securitypolicy/IncludeToken/Always"
                rel="nofollow" title="Visit page outside Confluence"><span style="font-size: 8pt"><span
                    style="color: #003366">http://schemas.xmlsoap.org/ws/2005/07/securitypolicy/IncludeToken/Always<sup><img
                        align="absMiddle" alt="" border="0" class="rendericon" height="7" src="http://wso2.org/wiki/images/icons/linkext7.gif"
                        width="7" /></sup></span></span></a></span>*<font color="#0000ff">"</font><font color="#0000ff">&gt;</font>-
        <font color="#0000ff">&lt;</font><font color="#990000">wsp:Policy</font><font color="#0000ff">&gt;</font><br />
        <font color="#ff0000"><b>&nbsp;</b></font> <font color="#0000ff">&lt;</font><font
            color="#990000">sp:WssX509V3Token10</font> <font color="#0000ff">/&gt;</font><br />
        <font color="#ff0000"><b>&nbsp;</b></font> <font color="#0000ff">&lt;/</font><font
            color="#990000">wsp:Policy</font><font color="#0000ff">&gt;</font><br />
        <font color="#ff0000"><b>&nbsp;</b></font> <font color="#0000ff">&lt;/</font><font
            color="#990000">sp:X509Token</font><font color="#0000ff">&gt;</font><br />
        <font color="#ff0000"><b>&nbsp;</b></font> <font color="#0000ff">&lt;/</font><font
            color="#990000">wsp:Policy</font><font color="#0000ff">&gt;</font><br />
        <font color="#ff0000"><b>&nbsp;</b></font> <font color="#0000ff">&lt;/</font><font
            color="#990000">sp:RecipientToken</font><font color="#0000ff">&gt;</font>- <font
                color="#0000ff">&lt;</font><font color="#990000">sp:AlgorithmSuite</font><font color="#0000ff">&gt;</font>-
        <font color="#0000ff">&lt;</font><font color="#990000">wsp:Policy</font><font color="#0000ff">&gt;</font><br />
        <font color="#ff0000"><b>&nbsp;</b></font> <font color="#0000ff">&lt;</font><font
            color="#990000">sp:Basic256Rsa15</font> <font color="#0000ff">/&gt;</font><br />
        <font color="#ff0000"><b>&nbsp;</b></font> <font color="#0000ff">&lt;/</font><font
            color="#990000">wsp:Policy</font><font color="#0000ff">&gt;</font><br />
        <font color="#ff0000"><b>&nbsp;</b></font> <font color="#0000ff">&lt;/</font><font
            color="#990000">sp:AlgorithmSuite</font><font color="#0000ff">&gt;</font>- <font
                color="#0000ff">&lt;</font><font color="#990000">sp:Layout</font><font color="#0000ff">&gt;</font>-
        <font color="#0000ff">&lt;</font><font color="#990000">wsp:Policy</font><font color="#0000ff">&gt;</font><br />
        <font color="#ff0000"><b>&nbsp;</b></font> <font color="#0000ff">&lt;</font><font
            color="#990000">sp:Strict</font> <font color="#0000ff">/&gt;</font><br />
        <font color="#ff0000"><b>&nbsp;</b></font> <font color="#0000ff">&lt;/</font><font
            color="#990000">wsp:Policy</font><font color="#0000ff">&gt;</font><br />
        <font color="#ff0000"><b>&nbsp;</b></font> <font color="#0000ff">&lt;/</font><font
            color="#990000">sp:Layout</font><font color="#0000ff">&gt;</font><br />
        <font color="#ff0000"><b>&nbsp;</b></font> <font color="#0000ff">&lt;</font><font
            color="#990000">sp:IncludeTimestamp</font> <font color="#0000ff">/&gt;</font><br />
        <font color="#ff0000"><b>&nbsp;</b></font> <font color="#0000ff">&lt;</font><font
            color="#990000">sp:EncryptBeforeSigning</font> <font color="#0000ff">/&gt;</font><br />
        <font color="#ff0000"><b>&nbsp;</b></font> <font color="#0000ff">&lt;</font><font
            color="#990000">sp:OnlySignEntireHeadersAndBody</font> <font color="#0000ff">/&gt;</font><br />
        <font color="#ff0000"><b>&nbsp;</b></font> <font color="#0000ff">&lt;/</font><font
            color="#990000">wsp:Policy</font><font color="#0000ff">&gt;</font><br />
        <font color="#ff0000"><b>&nbsp;</b></font> <font color="#0000ff">&lt;/</font><font
            color="#990000">sp:AsymmetricBinding</font><font color="#0000ff">&gt;</font>-
        <font color="#0000ff">&lt;</font><font color="#990000">sp:Wss10</font> <font color="#ff0000">
            xmlns:sp</font><font color="#0000ff">="</font><font color="#ff0000"><b><span class="nobr"><a
                href="http://schemas.xmlsoap.org/ws/2005/07/securitypolicy" rel="nofollow" title="Visit page outside Confluence"><span
                    style="font-size: 8pt"><span style="color: #003366">http://schemas.xmlsoap.org/ws/2005/07/securitypolicy<sup><img
                        align="absMiddle" alt="" border="0" class="rendericon" height="7" src="http://wso2.org/wiki/images/icons/linkext7.gif"
                        width="7" /></sup></span></span></a></span></b></font><font color="#0000ff">"</font><font
                            color="#0000ff">&gt;</font>- <font color="#0000ff">&lt;</font><font color="#990000">wsp:Policy</font><font
                                color="#0000ff">&gt;</font><br />
        <font color="#ff0000"><b>&nbsp;</b></font> <font color="#0000ff">&lt;</font><font
            color="#990000">sp:MustSupportRefIssuerSerial</font> <font color="#0000ff">/&gt;</font><br />
        <font color="#ff0000"><b>&nbsp;</b></font> <font color="#0000ff">&lt;/</font><font
            color="#990000">wsp:Policy</font><font color="#0000ff">&gt;</font><br />
        <font color="#ff0000"><b>&nbsp;</b></font> <font color="#0000ff">&lt;/</font><font
            color="#990000">sp:Wss10</font><font color="#0000ff">&gt;</font><font color="#0000ff">&lt;/</font><font
                color="#990000">wsp:All</font><font color="#0000ff">&gt;</font><br />
        &lt;/<font color="#990000">wsp:ExactlyOne</font>&gt;<br />
        &lt;/<font color="#990000">wsp:Policy</font>&gt;</p>
    <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
<rdf:Description
    rdf:about="http://www.wso2.org/wiki/display/wsfphp/WS-Security+API"
    dc:identifier="http://www.wso2.org/wiki/display/wsfphp/WS-Security+API"
    dc:title="WS-Security API"
    trackback:ping="http://www.wso2.org/wiki/rpc/trackback/68"/>
</rdf:RDF>
-->
    <!--
    Root decorator: all decisions about how a page is to be decorated via the
                    inline decoration begins here.
-->
    <!--
    Switch based upon the context. However, for now, just delegate to a decorator
    identified directly by the context.
-->
</body>
</html>
